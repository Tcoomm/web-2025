<!DOCTYPE html>
<html>
<head>
    <title>Определение знака зодиака</title>
    <meta charset="utf-8">
</head>
<body>
    <form method="post">
        <input type="text" name="date" placeholder="Например: 1-января-2000">
        <input type="submit" value="Определить">
    </form>
    <?php
    // Словарь для преобразования месяца из слова в номер (русский и английский)
    $months = [
        // Русские месяцы
        'янв' => 1, 'январь' => 1, 'января' => 1,
        'фев' => 2, 'февраль' => 2, 'февраля' => 2,
        'мар' => 3, 'март' => 3, 'марта' => 3,
        'апр' => 4, 'апрель' => 4, 'апреля' => 4,
        'май' => 5, 'мая' => 5,
        'июн' => 6, 'июнь' => 6, 'июня' => 6,
        'июл' => 7, 'июль' => 7, 'июля' => 7,
        'авг' => 8, 'август' => 8, 'августа' => 8,
        'сен' => 9, 'сентябрь' => 9, 'сентября' => 9,
        'окт' => 10, 'октябрь' => 10, 'октября' => 10,
        'ноя' => 11, 'ноябрь' => 11, 'ноября' => 11,
        'дек' => 12, 'декабрь' => 12, 'декабря' => 12,
        // Английские месяцы (если нужно)
        'jan' => 1, 'january' => 1,
        'feb' => 2, 'february' => 2,
        'mar' => 3, 'march' => 3,
        'apr' => 4, 'april' => 4,
        'may' => 5,
        'jun' => 6, 'june' => 6,
        'jul' => 7, 'july' => 7,
        'aug' => 8, 'august' => 8,
        'sep' => 9, 'september' => 9,
        'oct' => 10, 'october' => 10,
        'nov' => 11, 'november' => 11,
        'dec' => 12, 'december' => 12,
    ];

    if (!empty($_POST["date"])) {
        $input = trim($_POST["date"]);

        // Пытаемся распознать даты вида: ДД[sep]МЕСЯЦ[sep]ГГГГ (месяц словом или числом)
        if (preg_match('/^(\d{1,2})[^\w\d]+([a-zA-Zа-яА-Я]+|\d{1,2})[^\w\d]+(\d{2,4})$/u', $input, $matches)) {
            $d = (int)$matches[1];
            $m_raw = mb_strtolower($matches[2]);
            $y = (int)$matches[3];

            // Преобразуем месяц
            if (is_numeric($m_raw)) {
                $m = (int)$m_raw;
            } elseif (array_key_exists($m_raw, $months)) {
                $m = $months[$m_raw];
            } else {
                echo "<p>Неизвестный месяц: <b>$m_raw</b></p>";
                exit;
            }

            // Год к 4-значному виду (например, 24 → 2024, 99 → 1999)
            if ($y < 100) {
                $y = ($y <= 30) ? (2000 + $y) : (1900 + $y);
            }

            if (checkdate($m, $d, $y)) {
                // Определяем знак зодиака
                $sign = match(true) {
                    ($m == 1 && $d >= 20) || ($m == 2 && $d <= 18) => 'Водолей',
                    ($m == 2 && $d >= 19) || ($m == 3 && $d <= 20) => 'Рыбы',
                    ($m == 3 && $d >= 21) || ($m == 4 && $d <= 19) => 'Овен',
                    ($m == 4 && $d >= 20) || ($m == 5 && $d <= 20) => 'Телец',
                    ($m == 5 && $d >= 21) || ($m == 6 && $d <= 20) => 'Близнецы',
                    ($m == 6 && $d >= 21) || ($m == 7 && $d <= 22) => 'Рак',
                    ($m == 7 && $d >= 23) || ($m == 8 && $d <= 22) => 'Лев',
                    ($m == 8 && $d >= 23) || ($m == 9 && $d <= 22) => 'Дева',
                    ($m == 9 && $d >= 23) || ($m == 10 && $d <= 22) => 'Весы',
                    ($m == 10 && $d >= 23) || ($m == 11 && $d <= 21) => 'Скорпион',
                    ($m == 11 && $d >= 22) || ($m == 12 && $d <= 21) => 'Стрелец',
                    ($m == 12 && $d >= 22) || ($m == 1 && $d <= 19) => 'Козерог',
                    default => 'Неизвестно'
                };
                echo "<p>Дата: $d.$m.$y</p>";
                echo "<p>Ваш знак: <b>$sign</b></p>";
            } else {
                echo "<p>Некорректная дата!</p>";
            }
        }
        // Если не сработало — пробуем старый числовой формат (ДД[sep]ММ[sep]ГГГГ)
        elseif (preg_match('/^(\d{1,2})([^\w\d])(\d{1,2})\2(\d{2,4})$/', $input, $matches)) {
            $first = (int)$matches[1];
            $second = (int)$matches[3];
            $year = (int)$matches[4];

            // Определение дня и месяца
            if ($second <= 12) {
                $d = $first;
                $m = $second;
            } elseif ($first <= 12 && $second > 12) {
                $d = $second;
                $m = $first;
            } else {
                echo "<p>Ошибка: введите корректную дату (день или месяц не может быть больше 12 одновременно)</p>";
                exit;
            }

            // Преобразуем год
            if ($year < 100) {
                $y = ($year <= 30) ? (2000 + $year) : (1900 + $year);
            } else {
                $y = $year;
            }

            if (checkdate($m, $d, $y)) {
                $sign = match(true) {
                    ($m == 1 && $d >= 20) || ($m == 2 && $d <= 18) => 'Водолей',
                    ($m == 2 && $d >= 19) || ($m == 3 && $d <= 20) => 'Рыбы',
                    ($m == 3 && $d >= 21) || ($m == 4 && $d <= 19) => 'Овен',
                    ($m == 4 && $d >= 20) || ($m == 5 && $d <= 20) => 'Телец',
                    ($m == 5 && $d >= 21) || ($m == 6 && $d <= 20) => 'Близнецы',
                    ($m == 6 && $d >= 21) || ($m == 7 && $d <= 22) => 'Рак',
                    ($m == 7 && $d >= 23) || ($m == 8 && $d <= 22) => 'Лев',
                    ($m == 8 && $d >= 23) || ($m == 9 && $d <= 22) => 'Дева',
                    ($m == 9 && $d >= 23) || ($m == 10 && $d <= 22) => 'Весы',
                    ($m == 10 && $d >= 23) || ($m == 11 && $d <= 21) => 'Скорпион',
                    ($m == 11 && $d >= 22) || ($m == 12 && $d <= 21) => 'Стрелец',
                    ($m == 12 && $d >= 22) || ($m == 1 && $d <= 19) => 'Козерог',
                    default => 'Неизвестно'
                };
                echo "<p>Дата: $d.$m.$y</p>";
                echo "<p>Ваш знак: <b>$sign</b></p>";
            } else {
                echo "<p>Некорректная дата!</p>";
            }
        }
        // Не распознано — выводим подсказку
        else {
            echo "<p>Используйте формат <b>ДД[разделитель]ММ[разделитель]ГГГГ</b> или <b>ДД[разделитель]МЕСЯЦ[разделитель]ГГГГ</b>, где разделитель — любой символ кроме букв и цифр (например, точка, дефис, пробел, /).</p>
            <p>Примеры: 2.4.2002, 7-июля-21, 5 апр 1997, 15/aug/2003</p>";
        }
    }
    ?>
</body>
</html>
